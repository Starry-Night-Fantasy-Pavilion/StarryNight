# 数据库迁移文件命名与编号规范

适用目录：`database/migrations/`

## 1. 命名格式

统一使用：

`NNN_description.sql`

- `NNN`：三位递增数字（如 `001`、`020`、`135`）
- `description`：小写英文+下划线，语义清晰
- 扩展名固定为 `.sql`

示例：

- `020_email_templates_init.sql`
- `021_add_notice_bar_weight_index.sql`

## 2. 编号规则

1. 编号必须全局唯一，不允许重复编号。
2. 新迁移必须使用“当前最大编号 + 1”。
3. 禁止后补时插入旧编号（避免不同环境排序不一致）。

## 3. SQL 编写规则

1. 建表、改表统一使用 `__PREFIX__` 占位符，不直接写死 `sn_`。
2. 语句以分号结尾，保证脚本可拆分执行。
3. 数据初始化建议使用幂等写法（如 `INSERT IGNORE` / `ON DUPLICATE KEY UPDATE`）。

## 4. 执行顺序

由文件名自然排序（`natsort`）决定。

请确保依赖关系：

- 表结构迁移在前
- 初始化数据迁移在后

例如：

- `012_extra_tables.sql`（先创建 `notification_templates`）
- `020_email_templates_init.sql`（后插入模板数据）

## 5. 变更记录建议

每次新增迁移时，在 PR 描述中注明：

- 新增文件名
- 影响表
- 是否可重复执行
- 回滚策略（如有）

---

本规范用于降低多环境迁移冲突风险，并提升维护可读性。